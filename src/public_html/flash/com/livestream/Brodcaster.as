package com.livestream{		import flash.display.MovieClip;	import flash.display.Sprite;	import flash.events.*;	import flash.media.Camera;	import flash.media.Microphone;	import flash.media.Video;	import flash.net.NetConnection;	import flash.net.NetStream;	import flash.display.LoaderInfo;	import fl.controls.Button;		public class Brodcaster extends MovieClip	{				private var ns : NetStream;		private var nc : NetConnection;		private var _vid : Video;		private var _cam : Camera;		private var _mic : Microphone;		private var user_id : String;		private var paramObj : Object;				public function Brodcaster() : void {			getFlashVars();			broadcast_btn.enabled = false;			broadcast_btn.addEventListener(MouseEvent.CLICK , startBroadcasting);			nc = new NetConnection();			nc.client = this;			nc .addEventListener(NetStatusEvent.NET_STATUS, handleConnection);			nc.addEventListener(AsyncErrorEvent.ASYNC_ERROR, handleAsync);			nc.addEventListener(SecurityErrorEvent.SECURITY_ERROR, handleError);						nc.connect('rtmp://209.188.92.237/shared');		}				private function getFlashVars () : void {			paramObj = LoaderInfo(this.root.loaderInfo).parameters;			user_id = paramObj.user_id;			trace(user_id);			if ( user_id != null ){				user_txt.text = user_id;			}		}				private function publishLiveStream () : void {			ns = new NetStream(nc);			ns.addEventListener(NetStatusEvent.NET_STATUS, handleConnection);			//ns.client = new CustomClient();						_cam = Camera.getCamera();			_mic = Microphone.getMicrophone();						if ( _cam != null ) {				_cam.addEventListener(ActivityEvent.ACTIVITY, activityHandler);				_vid = new Video();				_vid.attachCamera(_cam);				addChild(_vid);								ns.attachCamera(_cam);			}						if ( _mic != null ) {				_mic.addEventListener(ActivityEvent.ACTIVITY, activityHandler);				ns.attachAudio(_mic);			}						broadcast_btn.enabled = true;		}				public function startBroadcasting ( e:MouseEvent ) : void {			if ( (_cam != null) || (_mic != null)){				trace('BRODCASTING ' + user_id);				ns.publish(String(user_id), 'live');			} else {				trace('check the camera or mic');			}		}				private function handleAsync ( e:AsyncErrorEvent ) : void {			trace('AsyncErrorEvent' + e );		}				private function handleError ( e:SecurityErrorEvent ) : void {			trace('Security Error' + e);		}				private function activityHandler ( e:ActivityEvent ) : void {			trace('activityMHandler: ' + e );			trace('activating: ' + e.activating);		}				public function handleConnection(e:NetStatusEvent):void{			trace("Calling handleConnection() now" + e.info.code);			switch( e.info.level ){				case "error":					trace("LEVEL ERROR");				break;			}						switch( e.info.code ){				case  "NetConnection.Connect.Success":					trace("Connected successfully to server.");					publishLiveStream();				break;								case "NetConnection.Connect.Rejected":					trace("REJECTED");				break;								case "NetConnection.Connect.Failed":					trace("FAILED");				break;								case "NetConnection.Connect.Closed":					trace("CLOSED");				break;								case "NetStream.Publish.Start":					trace("START");				break;								case "NetStream.Publish.BadName":					trace("BAD NAME");				break;								case "NetStream.Pause.Notify":					trace("PAUSE");				break;								case "NetStream.Unpause.Notify":					trace("UNPAUSE");				break;								case "NetStream.Play.StreamNotFound":					trace("STREAM NOT FOUND");				break;								case "NetStream.Record.NoAccess":					trace("NO ACCESS");				break;			}								}				public function onBWDonw () : void {}			}	}